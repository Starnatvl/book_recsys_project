# Прототип рекомендательной системы книг (Goodbooks-10k)

Этот репозиторий содержит решение двух этапов проекта по построению рекомендательной системы для сервиса чтения книг. Проект демонстрирует эволюцию от классических методов (EDA, SVD, Content-Based) до гибридной системы с использованием нейросетей (NCF).

# Проект: Гибридная рекомендательная система книг

## 1. Цель проекта
Разработать рекомендательную систему, которая предсказывает, какие книги могут понравиться пользователю, на основе его прошлых оценок и характеристик книг. В проекте объединены классические алгоритмы коллаборативной фильтрации, контентный подход и нейросетевая архитектура для повышения качества и устойчивости рекомендаций.

## 2. Данные
Использован набор данных Goodbooks-10k, включающий:
- `ratings.csv` – 981 756 оценок (пользователь, книга, оценка от 1 до 5);
- `books.csv` – информация о 10 000 книгах (название, автор, средний рейтинг, количество оценок и др.);
- `tags.csv` и `book_tags.csv` – теги, присвоенные книгам пользователями.

После загрузки проведена первичная проверка качества: типы данных, пропуски, дубликаты. Обнаружено 1644 дубликата в таблице оценок (один пользователь мог несколько раз оценить одну книгу). Дубликаты удалены с сохранением последней оценки. Пропуски в названиях книг заполнены основным названием.

## 3. Разведочный анализ (EDA)
Построены графики:
- распределение оценок (большинство оценок – 4 и 5);
- активность пользователей (логарифмическая шкала) – многие пользователи оставили мало оценок;
- популярность книг (long tail) – небольшое число книг имеет много оценок;
- топ-10 самых популярных тегов.

Разреженность матрицы пользователь–книга составила 99,8%, что характерно для реальных систем.

## 4. Конструирование признаков
Для обогащения данных созданы статистические признаки:
- для каждого пользователя: средняя оценка, количество оценок, стандартное отклонение его оценок;
- для каждой книги: средняя оценка, количество оценок, стандартное отклонение, а также взвешенный рейтинг по формуле IMDb (учитывающий количество голосов).

Эти признаки в дальнейшем могут использоваться моделями (хотя в текущей реализации они добавлены в датафреймы, но напрямую не подаются в нейросеть; они служат основой для будущих улучшений).

## 5. Модели

### 5.1. Базовая модель популярности (Popularity)
Книги ранжируются по взвешенному рейтингу (IMDB-формула). Модель не учитывает индивидуальные предпочтения, служит нижней границей качества.

### 5.2. Контентная модель (Content-based)
На основе объединённого текстового поля «название + теги» строится TF-IDF матрица и вычисляется косинусное сходство между книгами. Для пользователя рекомендации формируются как средняя похожесть книг из его истории на книги-кандидаты. Модель хорошо работает для новых книг, но не учитывает поведение других пользователей.

### 5.3. Коллаборативная фильтрация на основе элементов (Item-Based CF)
Строится матрица пользователь–книга, затем для каждой книги ищутся ближайшие соседи по косинусной мере. Оценка пользователя для книги вычисляется как среднее сходство этой книги с книгами, которые пользователь уже оценил. Модель показала наилучшие результаты среди всех.

### 5.4. Матричная факторизация (SVD)
Использована реализация из библиотеки Surprise. SVD раскладывает матрицу оценок на скрытые факторы пользователей и книг. Модель даёт высокую точность, но страдает от холодного старта.

### 5.5. Нейросетевая модель NCF (Neural Collaborative Filtering)
Реализована архитектура, объединяющая GMF (обобщённая матричная факторизация) и MLP (многослойный перцептрон). Эмбеддинги пользователей и книг размерности 50 конкатенируются и проходят через два полносвязных слоя. Модель обучалась 3 эпохи с MSE. На валидации достигнута ошибка около 0.81. Нейросеть способна улавливать нелинейные взаимодействия, но требует больше данных и тонкой настройки.

### 5.6. Гибридная модель (Hybrid)
Объединяет предсказания всех пяти моделей с весами (SVD – 0.3, NCF – 0.3, Content – 0.2, ItemCF – 0.2). Для новых пользователей (холодный старт) используется только модель популярности. Добавлен небольшой случайный шум для разнообразия.

## 6. Оценка качества
Для каждой модели рассчитаны метрики Precision@10, Recall@10 и nDCG@10 на тестовой выборке (20% данных). Оценка проводилась на 150 самых активных пользователях, для каждого формировался список кандидатов из книг, которые он оценил в тесте, плюс случайные книги.

Результаты:

| Модель       | Precision@10 | Recall@10 | nDCG@10 |
|--------------|--------------|-----------|---------|
| Popularity   | 0.3267       | 0.1264    | 0.3419  |
| SVD          | 0.5420       | 0.2286    | 0.5509  |
| NCF          | 0.3787       | 0.1472    | 0.3802  |
| Content      | 0.3073       | 0.1134    | 0.2932  |
| ItemCF       | 0.6627       | 0.2480    | 0.6806  |
| Hybrid       | 0.5027       | 0.2014    | 0.5162  |

## 7. Анализ результатов
- **Item-Based CF** неожиданно показал лучшие результаты по всем метрикам. Вероятно, это связано с тем, что на данном наборе данных косинусное сходство между книгами хорошо отражает реальные предпочтения пользователей. Модель эффективно использует информацию о том, какие книги часто оцениваются вместе.
- **SVD** также даёт высокие показатели, подтверждая эффективность матричной факторизации для разреженных данных.
- **NCF** уступил классическим методам. Причина – малое число эпох обучения (всего 3) и отсутствие настройки гиперпараметров. При более длительном обучении и подборе архитектуры нейросеть может догнать и перегнать SVD.
- **Content-based** модель показывает результат на уровне популярности, что говорит о том, что текстовые признаки (названия и теги) сами по себе недостаточно информативны для точных предсказаний.
- **Гибрид** занял промежуточное положение. Он уступает лучшей отдельной модели (ItemCF), но превосходит остальные. Важное преимущество гибрида – устойчивость: он сочетает сильные стороны разных подходов и может работать в ситуациях, когда одна из моделей даёт сбой (например, холодный старт).

## 8. Выводы о доверии к модели
Разработанная гибридная система не является «чёрным ящиком» – её поведение можно интерпретировать через веса отдельных компонентов. Высокие метрики Item-Based и SVD говорят о том, что коллаборативная информация (поведение пользователей) критически важна для точности. Гибрид, хоть и немного уступает лучшей модели, обеспечивает более гладкие и разнообразные рекомендации за счёт балансировки. На практике это означает, что пользователь с большей вероятностью получит релевантные, но при этом не слишком однообразные предложения.

Модель можно улучшить, дообучив нейросеть, добавив больше признаков (например, возраст пользователя, жанровые предпочтения) и оптимизировав веса гибрида на валидационной выборке. Тем не менее, уже в текущем виде система способна давать персонализированные рекомендации, существенно превосходящие по качеству простой топ популярных книг.

## 9. Заключение
В проекте реализован полный цикл разработки рекомендательной системы: от загрузки и очистки данных до обучения нескольких моделей и их объединения в гибрид. Полученные метрики подтверждают эффективность коллаборативных методов и показывают потенциал нейросетевых подходов. Гибридная архитектура позволяет сочетать преимущества различных алгоритмов и является предпочтительным выбором для реальных сервисов.

---
**Запуск:**
1. Установите зависимости: `pip install -r requirements.txt`
2. Запустите ноутбук в папке `notebook/`